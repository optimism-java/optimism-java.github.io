"use strict";(self.webpackChunkoptimism_java=self.webpackChunkoptimism_java||[]).push([[367],{2671:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>l});var t=r(4848),o=r(8453);r(1470),r(9365);const a={},s="Use docker",i={id:"superproof-docs/deployment/use_docker",title:"Use docker",description:"You can use Docker to run dispute explorer backend service Dispute-explorer.",source:"@site/docs/superproof-docs/deployment/use_docker.md",sourceDirName:"superproof-docs/deployment",slug:"/superproof-docs/deployment/use_docker",permalink:"/superproof-docs/deployment/use_docker",draft:!1,unlisted:!1,editUrl:"https://github.com/optimism-java/optimism-java.github.io/tree/main/docs/superproof-docs/deployment/use_docker.md",tags:[],version:"current",lastUpdatedBy:"thinkAfCod",lastUpdatedAt:1742539292e3,frontMatter:{},sidebar:"superProofSidebar",previous:{title:"Run a Super proof node",permalink:"/superproof-docs/deployment/"}},c={},l=[{value:"Prerequisites",id:"prerequisites",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"use-docker",children:"Use docker"}),"\n",(0,t.jsxs)(n.p,{children:["You can use Docker to run dispute explorer backend service ",(0,t.jsx)(n.a,{href:"https://github.com/optimism-java/dispute-explorer",children:"Dispute-explorer"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.p,{children:["Download and install ",(0,t.jsx)(n.a,{href:"https://www.docker.com/products/docker-desktop",children:"Docker"}),"."]}),"\n",(0,t.jsx)(n.h1,{id:"run-superproof-backend-step-by-step",children:"Run Superproof backend Step-by-Step"}),"\n",(0,t.jsx)(n.h1,{id:"step-1-config-environment-file",children:"Step 1. Config Environment file"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"mv .env.template .evn\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"#log_format you can use console or json\nLOG_FORMAT=console\n\n# config your mysql data source\nMYSQL_DATA_SOURCE=<data-source>\n\n# config chain name to tag your block chain name\nBLOCKCHAIN=<block-chain-name>\n\n# l1 rpc url example: eth json rpc url\nL1_RPC_URL=<l1-rpc>\n\nRPC_RATE_LIMIT=15\nRPC_RATE_BURST=5\n\n# the block number which before the first game has been created to make sure can not missing any game\nFROM_BLOCK_NUMBER=6034337\n\n# FROM_BLOCK_NUMBER block hash\nFROM_BLOCK_HASH=0xafc3e42c5899591501d29649ffef0bfdec68f8d77e6d44ee00ef88cfb1a2f163\n\n# the contract address of dispute game factory proxy\nDISPUTE_GAME_PROXY_CONTRACT=0x05F9613aDB30026FFd634f38e5C4dFd30a197Fa1\n\nAPI_PORT=8080\n"})}),"\n",(0,t.jsx)(n.h1,{id:"step-2-start-dispute-game-explorer-backend-service",children:"Step 2. Start Dispute Game Explorer backend service"}),"\n",(0,t.jsx)(n.p,{children:"use docker-compose to run this service"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"cd deploy\ndocker-compose -f docker-compose.yml up -d\n"})}),"\n",(0,t.jsx)(n.p,{children:"Now, this project is running now."}),"\n",(0,t.jsx)(n.p,{children:"Tip: if you just need a backend service to collect all data, Run Step 1 and Step 2."}),"\n",(0,t.jsx)(n.h1,{id:"step-3-run-meilisearch",children:"Step 3. Run meiliSearch"}),"\n",(0,t.jsx)(n.p,{children:"Run a meiliSearch service to sync MySql data for front service to search quickly"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"cd deploy\ndocker-compose -f docker-compose-meiliSearch.yml up -d meiliSearch\n"})}),"\n",(0,t.jsx)(n.p,{children:"Now, meiliSearch is running."}),"\n",(0,t.jsx)(n.h1,{id:"step-4-run-meilisync",children:"Step 4. Run meiliSync"}),"\n",(0,t.jsx)(n.p,{children:"first, we need to find the api_key of meiliSearch"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'curl -H "Authorization: Bearer <Token>" http://localhost:port/keys\n'})}),"\n",(0,t.jsx)(n.p,{children:"You should get a result, similar to :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "results": [\n    {\n      "name": "Default Search API Key",\n      "description": "Use it to search from the frontend",\n      "key": "d09536ef1e2742b4792c607465dc169f659f1b2dcb0107bfdce2542b602ed534",\n      "uid": "675ff658-9e73-460c-a3be-c6fcee624edf",\n      "actions": ["search"],\n      "indexes": ["*"],\n      "expiresAt": null,\n      "createdAt": "2024-08-06T08:47:38.225365511Z",\n      "updatedAt": "2024-08-06T08:47:38.225365511Z"\n    },\n    {\n      "name": "Default Admin API Key",\n      "description": "Use it for anything that is not a search operation. Caution! Do not expose it on a public frontend",\n      "key": "abc40e8457b32aa86d20ab0db0b42a86298b253209c4c31d9936b378e686d132",\n      "uid": "db1499f6-59a1-42c7-a13a-e18e191f456c",\n      "actions": ["*"],\n      "indexes": ["*"],\n      "expiresAt": null,\n      "createdAt": "2024-08-06T08:47:38.225052792Z",\n      "updatedAt": "2024-08-06T08:47:38.225052792Z"\n    }\n  ],\n  "offset": 0,\n  "limit": 20,\n  "total": 2\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["And, use ",(0,t.jsx)(n.code,{children:"Default Admin API Key"}),", ",(0,t.jsx)(n.code,{children:"key"})," to update config.yml"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"meilisearch:\n  api_url: http://localhost:7701\n  api_key: abc40e8457b32aa86d20ab0db0b42a86298b253209c4c31d9936b378e686d132\n"})}),"\n",(0,t.jsx)(n.p,{children:"launch the meiliSync service"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"cd deploy\ndocker-compose -f docker-compose-meiliSearch up -d meiliSync\n"})}),"\n",(0,t.jsx)(n.h1,{id:"step-5-validate-meilisync-service",children:"Step 5. Validate meiliSync Service"}),"\n",(0,t.jsxs)(n.p,{children:["We can visit meiliSearch api to validate meiliSync service. more ",(0,t.jsx)(n.a,{href:"https://www.meilisearch.com/docs/reference/api/overview",children:"meiliSearch docs"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'curl -H "Authorization: Bearer <Token>" http://localhost:port/indexes\n'})}),"\n",(0,t.jsx)(n.p,{children:"You should get a result, similar to :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "results": [\n    {\n      "uid": "disputegame",\n      "createdAt": "2024-08-06T09:24:24.640693956Z",\n      "updatedAt": "2024-08-07T07:02:32.402360903Z",\n      "primaryKey": "id"\n    },\n    {\n      "uid": "gameclaim",\n      "createdAt": "2024-08-06T09:24:24.670117944Z",\n      "updatedAt": "2024-08-07T07:02:28.94487306Z",\n      "primaryKey": "id"\n    },\n    {\n      "uid": "gamecredit",\n      "createdAt": "2024-08-06T10:37:42.013472322Z",\n      "updatedAt": "2024-08-07T07:02:32.379350451Z",\n      "primaryKey": "id"\n    },\n    {\n      "uid": "syncevents",\n      "createdAt": "2024-08-06T09:24:24.696318772Z",\n      "updatedAt": "2024-08-07T07:02:30.382386632Z",\n      "primaryKey": "id"\n    }\n  ],\n  "offset": 0,\n  "limit": 20,\n  "total": 4\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"If you get information like this, it means our deploy it`s success."}),"\n",(0,t.jsx)(n.h1,{id:"step-6-start-frontend",children:"Step 6. Start frontend"}),"\n",(0,t.jsx)(n.p,{children:"pull the docker image"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker pull ghcr.io/optimism-java/dispute-explorer-frontend:development\n"})}),"\n",(0,t.jsxs)(n.p,{children:["config the ",(0,t.jsx)(n.code,{children:"nginx.conf"}),", below is a example, you should change the server part"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'worker_processes  2;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    sendfile        on;\n    keepalive_timeout  65;\n\n    gzip  on;\n\n    server {\n        listen       80;\n        location / {\n            root   html;\n            index  index.html index.htm;\n            try_files  $uri $uri/ /index.html;\n        }\n        location \uff5e /index/ {\n            proxy_pass ${Sepolia meiliSearch}; # replace with Sepolia meiliSearch service url\n            proxy_set_header Host $host;\n            proxy_set_header X-Forward-For $remote_addr;\n            proxy_set_header X-Forward-Proto $scheme;\n            proxy_http_version 1.1;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection "upgrade";\n            proxy_set_header Authorization "Bearer $TOKEN"; # replace TOKEN with Sepolia meiliSearch token\n        }\n        location \uff5e /indexMain/ {\n            proxy_pass ${Mainnet meiliSearch}; # replace with Mainnet meiliSearch service url\n            proxy_set_header Host $host;\n            proxy_set_header X-Forward-For $remote_addr;\n            proxy_set_header X-Forward-Proto $scheme;\n            proxy_http_version 1.1;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection "upgrade";\n            proxy_set_header Authorization "Bearer $TOKEN"; # replace TOKEN with Mainnet meiliSearch token\n        }\n        location \uff5e /api/ {\n            proxy_pass ${Sepolia api server}; # replace with Sepolia api service url\n            proxy_set_header Host $host;\n            proxy_set_header X-Forward-For $remote_addr;\n            proxy_set_header X-Forward-Proto $scheme;\n            proxy_http_version 1.1;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection "upgrade";\n        }\n        location \uff5e /apiMain/ {\n            proxy_pass ${Mainnet api server}; # replace with Mainnet api service url\n            proxy_set_header Host $host;\n            proxy_set_header X-Forward-For $remote_addr;\n            proxy_set_header X-Forward-Proto $scheme;\n            proxy_http_version 1.1;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection "upgrade";\n        }\n    }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["start the image, replace the ",(0,t.jsx)(n.code,{children:"docker run -d -v"})," to the real ",(0,t.jsx)(n.code,{children:"nginx.conf"})," path. Then you can visit ",(0,t.jsx)(n.code,{children:"localhost:3000"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker run -d -v ${path to nginx.conf}:/etc/nginx/nginx.conf -p 3000:80 ghcr.io/optimism-java/dispute-explorer-frontend:development\n"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},9365:(e,n,r)=>{r.d(n,{A:()=>s});r(6540);var t=r(8215);const o={tabItem:"tabItem_Ymn6"};var a=r(4848);function s(e){let{children:n,hidden:r,className:s}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,t.A)(o.tabItem,s),hidden:r,children:n})}},1470:(e,n,r)=>{r.d(n,{A:()=>j});var t=r(6540),o=r(8215),a=r(3104),s=r(6347),i=r(205),c=r(7485),l=r(1682),d=r(679);function u(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:r}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:r,attributes:t,default:o}}=e;return{value:n,label:r,attributes:t,default:o}}))}(r);return function(e){const n=(0,l.X)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,r])}function h(e){let{value:n,tabValues:r}=e;return r.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:r}=e;const o=(0,s.W6)(),a=function(e){let{queryString:n=!1,groupId:r}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:n,groupId:r});return[(0,c.aZ)(a),(0,t.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(o.location.search);n.set(a,e),o.replace({...o.location,search:n.toString()})}),[a,o])]}function f(e){const{defaultValue:n,queryString:r=!1,groupId:o}=e,a=p(e),[s,c]=(0,t.useState)((()=>function(e){let{defaultValue:n,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=r.find((e=>e.default))??r[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:a}))),[l,u]=m({queryString:r,groupId:o}),[f,x]=function(e){let{groupId:n}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(n),[o,a]=(0,d.Dv)(r);return[o,(0,t.useCallback)((e=>{r&&a.set(e)}),[r,a])]}({groupId:o}),y=(()=>{const e=l??f;return h({value:e,tabValues:a})?e:null})();(0,i.A)((()=>{y&&c(y)}),[y]);return{selectedValue:s,selectValue:(0,t.useCallback)((e=>{if(!h({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);c(e),u(e),x(e)}),[u,x,a]),tabValues:a}}var x=r(2303);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=r(4848);function _(e){let{className:n,block:r,selectedValue:t,selectValue:s,tabValues:i}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,a.a_)(),d=e=>{const n=e.currentTarget,r=c.indexOf(n),o=i[r].value;o!==t&&(l(n),s(o))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const r=c.indexOf(e.currentTarget)+1;n=c[r]??c[0];break}case"ArrowLeft":{const r=c.indexOf(e.currentTarget)-1;n=c[r]??c[c.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":r},n),children:i.map((e=>{let{value:n,label:r,attributes:a}=e;return(0,b.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>c.push(e),onKeyDown:u,onClick:d,...a,className:(0,o.A)("tabs__item",y.tabItem,a?.className,{"tabs__item--active":t===n}),children:r??n},n)}))})}function v(e){let{lazy:n,children:r,selectedValue:o}=e;const a=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){const e=a.find((e=>e.props.value===o));return e?(0,t.cloneElement)(e,{className:"margin-top--md"}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==o})))})}function g(e){const n=f(e);return(0,b.jsxs)("div",{className:(0,o.A)("tabs-container",y.tabList),children:[(0,b.jsx)(_,{...n,...e}),(0,b.jsx)(v,{...n,...e})]})}function j(e){const n=(0,x.A)();return(0,b.jsx)(g,{...e,children:u(e.children)},String(n))}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>i});var t=r(6540);const o={},a=t.createContext(o);function s(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);